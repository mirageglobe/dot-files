# === references
# - https://devhints.io/ansible

# === variable constants

# variable string
myvar: "value"

# variable from other results
myvar: "{{ output_response.stdout }}"

# === loop

# === === nested array loop

- name: Read values {{ myvalue }}
  shell: |
      echo "{{ item }} # this is value";
  loop: {{ mylist | default([], true) }}
  when: mylist is defined

# === === nested array loop

# loop example for nested dictionary
dictionary:
  topic1:
    - t1-sub1
    - t1-sub2
  topic2:
    - t2-sub1
    - t2-sub2

allowlist:
  - topic1

# loops nested dictionary with conditional to check against allowlist
- name: Read values {{ myvalue }}
  shell: |
      echo "one : {{ item.0.key }} # this is key i.e. topic1";
      echo "two : {{ item.1 }} # this is value i.e. t1-sub1";
  loop: "{{ dictionary | dict2items | subelements('value') }}"
  when: item.0.key in allowlist

# loops from main task to subtask
- include_tasks: inner.yml
  with_items:
    - "{{ dictionary | dict2items }}"
  vars:
    mkey: "{{ item.key }}"
    mvalue: "{{ item.value }}"

# === helper functions

# === === debug using fact

# set fact will show values in logs without debug
- name: debug_set_fact
  set_fact:
    foo: "{{ output_response.stdout | from_json }}"

- name: debug_main
  debug:
    var: foo

# === === debug message

- name: debug {{ myvalue }}
  shell: |
    echo "one: {{ myvalue }}";
    printf "{{ myvalue2 }}";
  register: output_myresponse

- name: debug show value
  shell: |
    echo "{{ output_myresponse.stdout | default([], true) | from_json | json_query('id') }}";
  register: output_myresponse_id
